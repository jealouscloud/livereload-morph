<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LiveMorph Test Page</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <h1>LiveMorph Test Page</h1>

    <div class="test-section">
      <h2>HTML Morphing Test</h2>
      <p id="content">This is the original content.</p>
      <p class="instructions">
        Try editing this text in your editor. The page should update without a full reload!
      </p>
    </div>

    <div class="test-section">
      <h2>CSS Reload Test</h2>
      <div class="color-box">
        This box should change color when you edit styles.css
      </div>
      <p class="instructions">
        Try changing the background color in styles.css. It should update without a flash!
      </p>
    </div>

    <div class="test-section">
      <h2>@import Reload Test (WITH WebKit Workaround)</h2>
      <div class="imported-box">
        This box uses styles from @import url("imported.css")
      </div>
      <p class="instructions">
        Try changing the background color in test/imported.css.
        With importCacheWaitPeriod=200, it should reload WITHOUT flickering (takes ~400ms longer).
      </p>
    </div>

    <div class="test-section">
      <h2>Input State Preservation</h2>
      <input type="text" id="test-input" placeholder="Type something here...">
      <p class="instructions">
        Type in the input, then change the HTML. Your input should stay intact!
      </p>
    </div>

    <div class="test-section">
      <h2>Tabs (Checked State Preservation)</h2>
      <div class="tabs">
        <input type="radio" name="tabs" id="tab1" checked>
        <label for="tab1">Tab 1</label>

        <input type="radio" name="tabs" id="tab2">
        <label for="tab2">Tab 2</label>

        <input type="radio" name="tabs" id="tab3">
        <label for="tab3">Tab 3</label>

        <div class="tab-content" id="content1">
          <h3>Tab 1 Content</h3>
          <p>This is the content of tab 1.</p>
        </div>

        <div class="tab-content" id="content2">
          <h3>Tab 2 Content</h3>
          <p>This is the content of tab 2.</p>
        </div>

        <div class="tab-content" id="content3">
          <h3>Tab 3 Content</h3>
          <p>This is the content of tab 3.</p>
        </div>
      </div>
      <p class="instructions">
        Switch to a different tab, then edit the HTML. The active tab should stay selected!
      </p>
    </div>

    <div class="test-section">
      <h2>Multi-Step Form</h2>
      <div class="multi-step-form">
        <input type="radio" name="step" id="step1" checked>
        <input type="radio" name="step" id="step2">
        <input type="radio" name="step" id="step3">

        <div class="step-indicator">
          <label for="step1" class="step-label">Step 1</label>
          <label for="step2" class="step-label">Step 2</label>
          <label for="step3" class="step-label">Step 3</label>
        </div>

        <div class="step-content" id="step1-content">
          <h3>Step 1: Personal Info</h3>
          <input type="text" id="name" placeholder="Your name">
          <input type="email" id="email" placeholder="Your email">
          <label for="step2" class="btn">Next</label>
        </div>

        <div class="step-content" id="step2-content">
          <h3>Step 2: Address</h3>
          <input type="text" id="address" placeholder="Street address">
          <input type="text" id="city" placeholder="City">
          <div class="buttons">
            <label for="step1" class="btn">Back</label>
            <label for="step3" class="btn">Next</label>
          </div>
        </div>

        <div class="step-content" id="step3-content">
          <h3>Step 3: Review</h3>
          <p>Review your information before submitting.</p>
          <div class="buttons">
            <label for="step2" class="btn">Back</label>
            <button class="btn">Submit</button>
          </div>
        </div>
      </div>
      <p class="instructions">
        Navigate through the steps, fill in some fields, then edit the HTML. Your current step and field values should be preserved!
      </p>
    </div>

    <div class="test-section">
      <h2>Image Reload Test</h2>
      <div class="image-tests">
        <div>
          <h4>&lt;img&gt; element:</h4>
          <img src="test-image.svg" alt="Test image" width="100" height="100">
        </div>
        <div>
          <h4>CSS background-image:</h4>
          <div class="image-box"></div>
        </div>
        <div>
          <h4>Inline style background:</h4>
          <div style="width: 100px; height: 100px; background-image: url('test-image.svg'); background-size: cover; border: 2px solid #ddd; border-radius: 4px; display: inline-block;"></div>
        </div>
      </div>
      <p class="instructions">
        Edit test/test-image.svg (change the fill color from #3498db to #e74c3c or the text).
        All three boxes should update without a full page reload!
      </p>
    </div>

    <div class="test-section">
      <h2>Details/Summary (Open State)</h2>
      <details id="details1">
        <summary>Click to expand section 1</summary>
        <p>This content should stay expanded if you open it and then morph.</p>
      </details>
      <details id="details2">
        <summary>Click to expand section 2</summary>
        <p>Try opening this, editing the HTML, and checking if it stays open.</p>
      </details>
      <p class="instructions">
        Open one or both details sections, then edit the HTML. They should stay open!
      </p>
    </div>

    <div class="test-section">
      <h2>Declarative Shadow DOM Test</h2>
      <div id="shadow-host">
        <template shadowrootmode="open">
          <style>
            .shadow-content {
              padding: 10px;
              background: #e8f4fc;
              border: 2px solid #3498db;
              border-radius: 4px;
            }
          </style>
          <div class="shadow-content">
            <p id="shadow-text">Original shadow DOM content</p>
          </div>
        </template>
      </div>
      <p class="instructions">
        Edit the shadow DOM template content above. The shadow root should be recreated with the new content!
      </p>
    </div>

    <div class="status">
      <h3>Connection Status</h3>
      <p id="status">Checking connection...</p>
    </div>
  </div>

  <!-- Test script for JS reload verification -->
  <script src="test-script.js"></script>

  <!-- LiveMorph Script with verbose logging -->
  <script type="module">
    // Set options before loading
    window.LiveMorphOptions = {
      host: 'localhost',
      port: 35729,
      verbose: true,
      morphHTML: true,
      importCacheWaitPeriod: 200  // Enable WebKit workaround (reduces flicker)
    };
  </script>
  <script type="module" src="../dist/livereload-morph.js"></script>

  <script type="module">
    // Monitor connection events
    document.addEventListener('LiveMorphConnect', () => {
      document.getElementById('status').textContent = '✅ Connected to LiveReload server';
      document.getElementById('status').style.color = 'green';
    });

    document.addEventListener('LiveMorphDisconnect', () => {
      document.getElementById('status').textContent = '❌ Disconnected from LiveReload server';
      document.getElementById('status').style.color = 'red';
    });
  </script>
</body>
</html>
